import { useEffect, useRef } from 'react';

export default function AnimatedOrb() {
  const canvasRef = useRef<HTMLCanvasElement>(null);

  useEffect(() => {
    const canvas = canvasRef.current;
    if (!canvas) return;

    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    canvas.width = 180;
    canvas.height = 180;

    const centerX = 90;
    const centerY = 90;

    // Создаём звёзды
    const particles: any[] = [];
    const particleCount = 2400;

    for (let i = 0; i < particleCount; i++) {
      const spiralFactor = Math.random();
      const angleOffset = spiralFactor * Math.PI * 4;
      
      particles.push({
        angle: Math.random() * Math.PI * 2,
        distance: 35 + Math.random() * 40,
        size: 0.3 + Math.random() * 1.2,
        opacity: 0.2 + Math.random() * 0.6,
        speed: 0.00039 + Math.random() * 0.00104, // +30% (было 0.0003 + 0.0008)
        orbitOffset: (Math.random() - 0.5) * 20,
        spiralOffset: angleOffset,
        density: Math.random() < 0.3 ? 2 : 1
      });
    }

    let rotation = 0;

    function animate() {
      if (!ctx || !canvas) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      rotation += 0.0026; // +30% (было 0.002)
      
      particles.forEach(p => {
        p.angle += p.speed;
        
        const totalAngle = p.angle + rotation + p.spiralOffset * 0.1;
        const waveDistortion = Math.sin(rotation * 2 + p.angle * 3) * 7.5;
        const spiralDistortion = Math.sin(p.angle * 2 + rotation) * 5;
        
        const finalDistance = p.distance + waveDistortion + spiralDistortion + 
                             Math.sin(rotation * 3 + p.angle * 2) * p.orbitOffset;
        
        const x = centerX + Math.cos(totalAngle) * finalDistance;
        const y = centerY + Math.sin(totalAngle) * finalDistance;
        
        const twinkle = 0.4 + Math.sin(rotation * 5 + p.angle * 10) * 0.6;
        const finalOpacity = p.opacity * twinkle * p.density;
        
        ctx.beginPath();
        ctx.arc(x, y, p.size, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(255, 255, 255, ${finalOpacity})`;
        ctx.fill();
        
        ctx.shadowBlur = 2;
        ctx.shadowColor = 'rgba(110, 218, 209, 0.6)';
      });
      
      ctx.shadowBlur = 0;
      requestAnimationFrame(animate);
    }

    animate();
  }, []);

  return (
    <>
      <canvas 
        ref={canvasRef}
        style={{
          position: 'absolute',
          inset: 0,
          margin: 'auto',
          zIndex: 1,
          pointerEvents: 'none'
        }}
      />
      <svg
        width="72"
        height="72"
        viewBox="0 0 317.58146 304.12158"
        style={{
          position: 'absolute',
          inset: 0,
          margin: 'auto',
          zIndex: 2,
          filter: 'drop-shadow(0 0 10px rgba(110, 218, 209, 0.5))'
        }}
      >
        <path
          style={{ fill: '#ffffff', fillOpacity: 1, stroke: 'none' }}
          d="m 524.0415,636.43398 c 8.2053,-3.07001 15.4342,-9.16005 19.1223,-16.10982 2.6142,-4.92616 3.4315,-19.8308 1.4994,-27.34335 -1.0192,-3.96254 -0.8566,-4.16487 4.6666,-5.80938 8.3861,-2.49688 26.4546,-12.32818 38.1239,-20.74368 36.9825,-26.67041 49.3489,-56.43832 32.3581,-77.89093 -4.2349,-5.34703 -18.1328,-13.45048 -23.0683,-13.45048 -2.3421,0 -2.4604,-0.6241 -1.4537,-7.66666 0.6028,-4.21667 1.0956,-17.56667 1.0952,-29.66667 -7e-4,-18.93375 -0.4322,-23.54897 -3.0961,-33.11371 -4.0458,-14.52602 -6.8345,-20.77019 -12.923,-28.93547 -9.1573,-12.28089 -19.5298,-17.45185 -32.625,-16.26442 -8.2334,0.74658 -13.9975,3.23006 -21.5149,9.26984 l -4.8264,3.87771 -9.84025,-7.43949 c -11.76736,-8.89643 -40.83278,-23.41673 -53.84027,-26.89714 -6.17468,-1.65216 -13.84568,-2.49732 -22.66666,-2.49732 -11.91651,0 -14.14436,0.39826 -20.96566,3.74793 -9.65249,4.73995 -16.32741,12.41396 -18.43332,21.19239 -1.53759,6.4094 -1.16281,17.83361 0.74373,22.67052 0.68396,1.73521 -0.004,2.49051 -2.89019,3.17212 -6.80265,1.60663 -27.70891,12.04996 -39.87751,19.92005 -16.36347,10.58315 -33.63553,28.13055 -39.34824,39.9755 -7.66564,15.8942 -5.69987,28.93379 6.20601,41.16652 4.82982,4.96242 16.9942,11.4883 21.41441,11.4883 1.51604,0 1.89804,0.84095 1.36276,3 -0.40908,1.65 -1.46681,9.70269 -2.35052,17.89486 -2.77259,25.70241 1.90057,56.19501 11.06965,72.22998 8.8769,15.52402 19.0799,22.09762 34.40221,22.16471 10.5891,0.0464 17.45837,-2.45859 25.65458,-9.35524 l 3.71462,-3.12565 10.16022,7.28962 c 19.63917,14.09047 46.79063,26.86586 63.40495,29.8335 10.19406,1.82086 26.11488,0.63595 34.72138,-2.58414 z m -46.32242,-12.55736 c -17.85075,-3.4079 -46.59761,-14.77525 -57.46995,-22.72529 -2.38556,-1.74437 -2.39191,-1.93766 -0.14505,-4.4204 2.30938,-2.55185 2.43457,-2.51177 7.31563,2.34171 14.66434,14.5815 45.82848,15.82797 82.2508,3.28978 8.28539,-2.85222 13.75609,-4.10185 14.53729,-3.32065 0.6889,0.68892 1.3108,3.93642 1.3819,7.21669 0.15,6.9166 -3.024,12.05492 -9.95239,16.11166 -5.67679,3.32389 -24.4846,4.07113 -37.91823,1.5065 z m -20.3598,-26.77291 c -12.60371,-3.54491 -19.23907,-8.63204 -21.14046,-16.20776 -1.57352,-6.26944 6.62286,-20.04377 19.48854,-32.75121 6.52909,-6.44878 12.67187,-11.72506 13.65063,-11.72506 2.25013,0 23.22692,17.94182 33.4288,28.59223 7.33706,7.65964 18.26561,23.84503 18.26561,27.0517 0,5.39588 -48.72074,9.2512 -63.69312,5.0401 z m -80.30686,-1.61965 c -7.6259,-2.76475 -17.46071,-18.11795 -23.74236,-37.06438 -5.44818,-16.43257 -7.42995,-30.97104 -7.04278,-51.66667 0.11048,-5.90568 0.35319,-6.33333 3.59446,-6.33333 2.80438,0 3.28183,0.45083 2.47112,2.33333 -2.19547,5.09795 -2.22235,18.70409 -0.0517,26.17087 4.76257,16.38267 20.27309,36.57695 42.33246,55.11574 l 4.89453,4.11339 -2.89453,2.63338 c -5.73227,5.2151 -13.19238,7.00666 -19.5612,4.69767 z M 541.295,583.75301 c -1.343,-2.94749 -1.2117,-3.33333 1.1339,-3.33333 9.5139,0 25.8761,-14.08771 33.6295,-28.95471 5.7488,-11.02313 12.1394,-30.78448 14.4594,-44.71196 1.8897,-11.34414 2.4285,-11.77421 10.1572,-8.10671 18.7091,8.87803 9.0026,35.75731 -23.3399,64.63326 -11.7048,10.45018 -30.7815,23.80679 -34.0025,23.80679 -0.2853,0 -1.2023,-1.5 -2.0376,-3.33334 z m -145.77221,-7 c -15.35881,-15.95664 -29.07701,-44.21108 -29.12121,-59.97896 -0.0121,-4.32977 0.8651,-6.63156 3.7637,-9.87566 3.70802,-4.14999 4.04764,-4.24195 17.95053,-4.86028 12.76517,-0.56772 15.33329,-0.26572 25.88714,3.04427 6.44387,2.02098 12.24448,4.15699 12.89025,4.74668 2.89386,2.64261 -6.49579,39.51832 -15.04279,59.07712 -3.0806,7.0496 -7.74319,14.18017 -9.27224,14.18017 -0.52763,0 -3.70255,-2.85 -7.05538,-6.33334 z M 531.5631,560.07972 C 523.1189,552.8357 511.71908,527.54593 511.71908,516.057 v -4.63599 l 13.00002,-4.85397 c 22.5567,-8.42227 30.6328,-10.31188 47.4832,-11.10997 15.0668,-0.71361 15.7816,-0.62955 15.0794,1.77341 -0.4055,1.38739 -1.3931,5.06156 -2.1948,8.16482 -2.0474,7.92603 -8.3119,21.5018 -14.0898,30.53409 -15.0345,23.50278 -29.7113,32.49117 -39.434,24.15033 z m -68.84402,-61.89331 c -5.3158,-3.09554 -5.66666,-3.66519 -5.66666,-9.19997 0,-3.24505 -0.15,-6.30016 -0.33334,-6.78912 -0.18333,-0.48897 2.4892,-2.87449 5.93896,-5.30117 l 6.27229,-4.41213 6.72771,3.49046 c 6.67915,3.46526 6.72771,3.53721 6.72771,9.96783 0,3.56255 0.0463,6.92737 0.10296,7.47737 0.0566,0.55 -0.9908,1.6 -2.32761,2.33333 -1.33682,0.73333 -4.02577,2.38333 -5.97546,3.66667 -4.34351,2.85901 -4.46077,2.8464 -11.46656,-1.23327 z M 350.38576,477.98717 c 0,-2.36326 5.95332,-17.58109 10.02065,-25.61472 16.46787,-32.52666 38.45607,-48.44575 50.40757,-36.49424 8.01158,8.01157 16.90511,30.35805 16.90511,42.47691 0,4.08692 -0.29006,4.27995 -13.66667,9.09549 -7.51667,2.70597 -18.46667,6.14736 -24.33333,7.64754 -12.67876,3.24211 -39.33333,5.19988 -39.33333,2.88902 z m -13.64248,-2.9792 c -5.73963,-3.03047 -9.02419,-8.49356 -9.02419,-15.0096 0,-16.96224 31.32464,-50.92721 63.68966,-69.05802 4.91986,-2.75609 5.8642,-2.91674 6.97959,-1.18734 2.04645,3.17299 1.67427,3.59693 -4.52919,5.15897 -17.99667,4.53162 -36.9583,31.92731 -44.2031,63.86447 -1.78537,7.87044 -3.25157,15.35989 -3.25821,16.64323 -0.0157,3.03805 -3.39364,2.894 -9.65456,-0.41171 z m 195.86492,-3.1741 c -3.5443,-1.02361 -9.6943,-3.18025 -13.6666,-4.79251 -6.18464,-2.51015 -7.21952,-3.43605 -7.20163,-6.44321 0.0364,-6.11581 5.12753,-27.98882 9.46033,-40.64425 3.4969,-10.21387 10.7537,-26.66089 12.6968,-28.77642 0.8472,-0.92245 9.6038,7.944 15.7117,15.90886 8.877,11.5759 14.9675,22.52542 18.6788,33.58122 5.1783,15.42614 4.3818,25.32069 -2.3959,29.76164 -4.5855,3.00448 -24.7914,3.85724 -33.2835,1.40467 z m 53.4182,1.11538 c -0.4421,-0.44207 -0.2421,-2.28113 0.4445,-4.0868 3.4306,-9.02333 -0.2276,-26.71345 -8.3965,-40.6022 -5.4398,-9.24895 -20.1182,-25.66207 -30.3243,-33.90825 -5.1504,-4.16132 -9.3644,-8.07681 -9.3644,-8.70111 0,-0.62429 2.2393,-2.65671 4.9762,-4.51648 14.0812,-9.5684 28.943,1.84352 40.2424,30.90079 3.2145,8.26627 8.0973,40.01618 8.1075,52.71781 0.01,7.84101 -0.3075,9 -2.4372,9 -1.3444,0 -2.8061,-0.36169 -3.2482,-0.80376 z M 457.71908,428.23269 c -6.6,-5.78161 -14.78419,-13.36121 -18.18708,-16.84356 -6.90796,-7.06924 -19.81291,-25.18359 -19.81291,-27.81087 0,-2.38453 7.77795,-4.3847 23.33333,-6.00037 24.10881,-2.50407 43.01007,0.36734 53.7818,8.17034 4.92646,3.56871 5.55153,4.62534 5.55153,9.3845 0,10.67482 -12.71491,29.36503 -26.83738,39.44946 l -5.82929,4.16251 z M 513.452,377.25244 c -0.58644,-1.00865 -4.69421,-3.65568 -9.12838,-5.88229 -18.88923,-9.4852 -41.35511,-9.09109 -73.60049,1.29113 -14.69617,4.73181 -15.40795,4.41318 -14.62245,-6.54589 0.85876,-11.98124 8.45524,-16.36591 28.28507,-16.32609 18.86058,0.0379 44.0114,7.46901 66,19.50056 10.57575,5.78674 10.07215,5.29966 8.02675,7.76426 -2.09019,2.5185 -3.57696,2.57794 -4.9605,0.19832 z"
          transform="translate(-309.72469,-335.75301)"
        />
      </svg>
    </>
  );
}